worker_processes auto;

error_log /var/log/nginx/error.log info;

events {
    worker_connections  1024;
}

stream {
    upstream masters {
        hash $remote_addr consistent;
        {% for server in groups.master %}
        server {{server}}:6443;
        {%endfor%}
    }

    server {
        listen 443;
        proxy_connect_timeout 1s;
        proxy_timeout 3s;
        proxy_pass masters;
    }
}